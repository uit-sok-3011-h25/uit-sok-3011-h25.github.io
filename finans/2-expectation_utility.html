<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.25">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Espen Sirnes">
<meta name="dcterms.date" content="2025-08-10">

<title>2 - Utility, investor types and optimal portfolio with one asset</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="2-expectation_utility_files/libs/clipboard/clipboard.min.js"></script>
<script src="2-expectation_utility_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="2-expectation_utility_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="2-expectation_utility_files/libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="2-expectation_utility_files/libs/quarto-html/popper.min.js"></script>
<script src="2-expectation_utility_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="2-expectation_utility_files/libs/quarto-html/anchor.min.js"></script>
<link href="2-expectation_utility_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="2-expectation_utility_files/libs/quarto-html/quarto-syntax-highlighting-7b89279ff1a6dce999919e0e67d4d9ec.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="2-expectation_utility_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="2-expectation_utility_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="2-expectation_utility_files/libs/bootstrap/bootstrap-9e3ffae467580fdb927a41352e75a2e0.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN" && texText && texText.data) {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="2-expectation_utility.ipynb" download="2-expectation_utility.ipynb"><i class="bi bi-journal-code"></i>Jupyter</a></li><li><a href="2-expectation_utility.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">2 - Utility, investor types and optimal portfolio with one asset</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Espen Sirnes </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">August 10, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="expected-utility" class="level1">
<h1>Expected Utility</h1>
<p>In finance, the utility function is typically defined as the utility derived from a certain amount <span class="math inline">\(x\)</span>. It is generally assumed that greater wealth yields higher utility; hence, the utility function should be increasing, meaning <span class="math inline">\(U'(x) &gt; 0\)</span>. In situations involving risk, such as holding shares with uncertain future values, it becomes useful to calculate the <em>expected utility</em> of a set of possible outcomes <span class="math inline">\(x_i\)</span> with probabilities <span class="math inline">\(P(x_i)\)</span> and utilities <span class="math inline">\(u(x_i)\)</span> <span class="citation" data-cites="vonNeumann1947">(<a href="#ref-vonNeumann1947" role="doc-biblioref">Neumann and Morgenstern 1947</a>)</span>.</p>
<p>This builds on the general notion of expectations in statistics. For a set of outcomes <span class="math inline">\(x_i\)</span> and probabilities <span class="math inline">\(P(x_i)\)</span>, for example, the expected value is <span class="math inline">\(X=\{ x_0, x_1,\dots,x_n \}\)</span> and is given by</p>
<p><span id="eq-descrete_exp"><span class="math display">\[
\mathbb{E}[X] = \sum_{i=0}^{N} P(x_i) x_i
\tag{1}\]</span></span></p>
<p>For example:</p>
<div id="16f5b4a0" class="cell" data-execution_count="1">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> np.array([<span class="fl">0.5</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>])</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.array([<span class="dv">3</span>,<span class="dv">10</span>, <span class="dv">20</span>])</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>np.<span class="bu">sum</span>(p<span class="op">*</span>x)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="14">
<pre><code>np.float64(9.5)</code></pre>
</div>
</div>
<p>In the same way, the discrete expected utility for a set of outcomes <span class="math inline">\(x_i\)</span> with probabilities <span class="math inline">\(P(x_i)\)</span> is defined as follows:</p>
<p><span id="eq-descrete_exp"><span class="math display">\[
U(X) = \mathbb{E}[u(X)] = \sum_{i=0}^{N} P(x_i) u(x_i)
\tag{2}\]</span></span></p>
<p>where <span class="math inline">\(P(x_i)\)</span> is the probability that <span class="math inline">\(X\)</span> assumes the value <span class="math inline">\(x_i\)</span>, and <span class="math inline">\(u(x_i)\)</span> represents the utility derived if that event occurs.</p>
<p>For example, say utilities 2, -4, and 6 occur with probabilities 0.5, 0.2, and 0.3; then the expected utility is</p>
<div id="9c14747b" class="cell" data-execution_count="2">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> np.array([<span class="fl">0.5</span>, <span class="fl">0.2</span>, <span class="fl">0.3</span>])</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>u <span class="op">=</span> np.array([<span class="dv">2</span>, <span class="op">-</span><span class="dv">4</span>, <span class="dv">6</span>])</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>U <span class="op">=</span> np.<span class="bu">sum</span>(p<span class="op">*</span>u)</span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>U</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="15">
<pre><code>np.float64(1.9999999999999998)</code></pre>
</div>
</div>
<p>For a continuous distribution, the idea is the same. We multiply each utility state <span class="math inline">\(u(x_i)\)</span> with the probability it occurs <span class="math inline">\(f(x)dx\)</span>. The integral sign <span class="math inline">\(\int_{-\infty}^{\infty} \dots ,\)</span> <span class="citation" data-cites="Leibniz1969">(<a href="#ref-Leibniz1969" role="doc-biblioref">Leibniz 1969</a>)</span> is the equivalent of a sum for continuous variables. The expected utility is therefore given by:</p>
<p><span id="eq-cont_exp"><span class="math display">\[
U(X) = \mathbb{E}[u(X)] = \int_{-\infty}^{\infty} u(x) f(x)\ dx,
\tag{3}\]</span></span></p>
<p>where <span class="math inline">\(f(x)\)</span> is the density function of <span class="math inline">\(X\)</span>, such as the normal distribution.</p>
<section id="discrete-normal-distribution" class="level2">
<h2 class="anchored" data-anchor-id="discrete-normal-distribution">Discrete normal distribution</h2>
<p>To make this a bit more tangible, let us assume <span class="math inline">\(f(x)\)</span> represents the standard normal distribution (variance = 1 and mean = 0), and assume we categorize the outcomes <span class="math inline">\(x\)</span> into five intervals. In Python, we can obtain discrete equivalents of the normal probabilities <span class="citation" data-cites="Gauss1809">(<a href="#ref-Gauss1809" role="doc-biblioref">Gauss 1809</a>)</span> of a set of intervals in the range <code>-minmax</code> to <code>minmax</code>, each with a width of <code>dx</code>, as follows:</p>
<div id="6176b40d" class="cell" data-execution_count="3">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>dx <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>minmax <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the x range from -minmax to minmax</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="op">-</span>minmax, minmax <span class="op">+</span> dx, dx)</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate the corresponding standard normal distribution,</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a><span class="co"># where mean = 0 and standard deviation = 1</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> norm.pdf(x, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Outcomes: </span><span class="sc">{</span>x<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>p_perc <span class="op">=</span> [<span class="ss">f"</span><span class="sc">{</span>i<span class="sc">}</span><span class="ss">%"</span> <span class="cf">for</span> i <span class="kw">in</span> np.<span class="bu">round</span>(p<span class="op">*</span><span class="dv">100</span>,<span class="dv">0</span>)]</span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Probabilities: </span><span class="sc">{</span>p_perc<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Sum of probabilities: </span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(dx<span class="op">*</span>p)<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Outcomes: [-4 -2  0  2  4]
Probabilities: ['0.0%', '5.0%', '40.0%', '5.0%', '0.0%']
Sum of probabilities: 1.014383747758677</code></pre>
</div>
</div>
<p>Probabilities sum by definition to one, but we see that these do not sum to exactly 1.0. This discrepancy arises due to the coarse nature of the discrete categories.</p>
<p>We can use the function <code>plot_descrete_and_normal</code> in the local module <code>utility.py</code> in this repository to visualize the probabilities and the normal distribution:</p>
<p><em><a href="#fig-discrete-normal" class="quarto-xref">Figure&nbsp;1</a></em>:</p>
<div id="cell-fig-discrete-normal" class="cell" data-execution_count="4">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Using utility.plot_descrete_and_normal() to plot the discrete </span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="co"># distribution and the corresponding normal distribution.</span></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot  <span class="im">as</span> plt</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> utility</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> utility.plot_descrete_and_normal(p, x, dx, minmax, plt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-discrete-normal" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-discrete-normal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="2-expectation_utility_files/figure-html/fig-discrete-normal-output-1.png" width="598" height="449" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-discrete-normal-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1: Discrete version of the normal distribution
</figcaption>
</figure>
</div>
</div>
</div>
<ul>
<li><strong>Challenge 1</strong>: Reduce the interval size <span class="math inline">\(dx\)</span> and sum the probabilities to observe if the total approaches 1.</li>
</ul>
<p>As demonstrated above, decreasing the interval size <span class="math inline">\(dx\)</span> brings the discrete distribution closer to the continuous one. The continuous distribution serves as an approximation when outcomes are real numbers, which is often the case in investment scenarios.</p>
<p>The primary advantage of continuous variables over discrete ones is that we can apply powerful mathematical tools, such as derivatives and integrals, from calculus.</p>
</section>
<section id="calculating-the-mean-and-variance-with-a-discrete-distribution" class="level2">
<h2 class="anchored" data-anchor-id="calculating-the-mean-and-variance-with-a-discrete-distribution">Calculating the mean and variance with a discrete distribution</h2>
<p>With the discrete distribution given by the probabilities <code>p</code> and values <code>x</code> calculated in <a href="#fig-discrete-normal" class="quarto-xref">Figure&nbsp;1</a>, we can, for example, calculate the expected value and variance with these probabilities. Since the standard normal distribution was assumed, we would expect the mean to be close to 0 and the variance to be close to 1.</p>
<div id="6f6861e3" class="cell" data-execution_count="5">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>dx <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>minmax <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>true_mean <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>true_variance <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="op">-</span>minmax <span class="op">+</span> true_mean, minmax <span class="op">+</span> true_mean <span class="op">+</span> dx, dx)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> norm.pdf(x, true_mean, true_variance<span class="op">**</span><span class="fl">0.5</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>mean <span class="op">=</span> np.<span class="bu">sum</span>(p<span class="op">*</span>x<span class="op">*</span>dx)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>variance <span class="op">=</span> np.<span class="bu">sum</span>(</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>        p<span class="op">*</span>((x<span class="op">-</span>mean)<span class="op">**</span><span class="dv">2</span>)<span class="op">*</span>dx</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Numerically calculated mean is: </span><span class="sc">{</span>mean<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Numerically variance is: </span><span class="sc">{</span>variance<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Numerically calculated mean is: 5.551115123125783e-17
Numerically variance is: 0.9999999999999498</code></pre>
</div>
</div>
<p>We see that the mean is quite close to zero, but the variance is not that close to one. The likely reason for the latter is the coarse grouping.</p>
<ul>
<li><strong>Challenge 2</strong>: See if a finer categorization gives a more exact variance estimate.</li>
</ul>
</section>
<section id="calculating-expected-utility" class="level2">
<h2 class="anchored" data-anchor-id="calculating-expected-utility">Calculating expected utility</h2>
<p>Let us now return to the main topic: expected utility theory. A key outcome of this model is that with a concave utility function, an individual will always prefer a guaranteed cash flow over a speculative investment with the same expected return. Consider an individual with an exponential <span class="citation" data-cites="Euler1748">(<a href="#ref-Euler1748" role="doc-biblioref">Euler 1748</a>)</span> utility function:</p>
<p><span id="eq-CARA_utility"><span class="math display">\[
u(x) = -\mathrm{e}^{-\rho\cdot x}
\tag{4}\]</span></span></p>
<p>which is increasing and concave, as shown by its first and second derivatives:</p>
<p><span id="eq-CARA_utility_derivative"><span class="math display">\[
u'(x) = -\rho \cdot u(x)&gt;0
\tag{5}\]</span></span> <span id="eq-CARA_utility_2derivative"><span class="math display">\[
u''(x) = \rho^2 \cdot u(x)&lt; 0
\tag{6}\]</span></span></p>
<p>Suppose there is a 50% chance of <span class="math inline">\(x=0.5\)</span> and a 50% chance of <span class="math inline">\(x=1.5\)</span>. That is, the possible outcomes are given by <span class="math inline">\(X = {0.5, 1.5}\)</span>, with associated probabilities <span class="math inline">\(P(X) = {0.5, 0.5}\)</span>. The expected value is then <span class="math inline">\(\frac{1}{2}(-\mathrm{e}^{-\rho\cdot 0.5}-\mathrm{e}^{-\rho\cdot 1.5})\)</span>.</p>
<p>Below is the utility function defined as the function <code>u_func(x, rho)</code>. It is convenient to also define the inverse of the utility function <code>x_func(u, rho)</code>. Assuming <span class="math inline">\(\rho = 15.0\)</span>, we can calculate expected utilities and outcomes as follows:</p>
<div id="4d01e683" class="cell" data-execution_count="6">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Values and probabilities</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>x_gamble <span class="op">=</span> np.array([<span class="fl">0.5</span>, <span class="fl">1.5</span>])  <span class="co"># Outcomes of the </span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>                                 <span class="co"># gamble</span></span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a>p_gamble <span class="op">=</span> np.array([<span class="fl">0.5</span>, <span class="fl">0.5</span>])  <span class="co"># Probabilities</span></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>RHO <span class="op">=</span> <span class="fl">5.0</span></span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-9"><a href="#cb10-9" aria-hidden="true" tabindex="-1"></a><span class="co">#utility function</span></span>
<span id="cb10-10"><a href="#cb10-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> u_func(x, rho):</span>
<span id="cb10-11"><a href="#cb10-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>np.exp(<span class="op">-</span>rho<span class="op">*</span>np.array(x))</span>
<span id="cb10-12"><a href="#cb10-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-13"><a href="#cb10-13" aria-hidden="true" tabindex="-1"></a><span class="co"># We will also need the inverse of the utility function:</span></span>
<span id="cb10-14"><a href="#cb10-14" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> x_func(u, rho): </span>
<span id="cb10-15"><a href="#cb10-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="op">-</span>np.log(<span class="op">-</span>u)<span class="op">/</span>rho</span>
<span id="cb10-16"><a href="#cb10-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-17"><a href="#cb10-17" aria-hidden="true" tabindex="-1"></a><span class="co"># Expected utility</span></span>
<span id="cb10-18"><a href="#cb10-18" aria-hidden="true" tabindex="-1"></a>expected_utility <span class="op">=</span> np.<span class="bu">sum</span>(p_gamble <span class="op">*</span> </span>
<span id="cb10-19"><a href="#cb10-19" aria-hidden="true" tabindex="-1"></a>                                u_func(x_gamble, RHO))</span>
<span id="cb10-20"><a href="#cb10-20" aria-hidden="true" tabindex="-1"></a>expected_outcome <span class="op">=</span> np.<span class="bu">sum</span>(p_gamble <span class="op">*</span> </span>
<span id="cb10-21"><a href="#cb10-21" aria-hidden="true" tabindex="-1"></a>                                x_gamble)</span>
<span id="cb10-22"><a href="#cb10-22" aria-hidden="true" tabindex="-1"></a>utility_exp_outcome <span class="op">=</span> u_func(expected_outcome, RHO)</span>
<span id="cb10-23"><a href="#cb10-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-24"><a href="#cb10-24" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Expected utility: </span><span class="sc">{</span>expected_utility<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-25"><a href="#cb10-25" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Expected outcome: </span><span class="sc">{</span>expected_outcome<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb10-26"><a href="#cb10-26" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"Utility of expected value: </span><span class="sc">{</span>utility_exp_outcome<span class="sc">}</span><span class="ss">"</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Expected utility: -0.04131904149702332
Expected outcome: 1.0
Utility of expected value: -0.006737946999085467</code></pre>
</div>
</div>
<ul>
<li><strong>Challenge 3</strong>: Now, assume the utility function is <span class="math inline">\(f(x) = -\mathrm{log}(\rho x)\)</span> (the natural logarithm). What is the expected utility?</li>
</ul>
<p>By comparing the utility of the expected value of 1.0 with the expected utility, you can verify that the utility of the expected value is greater than the expected utility:</p>
<p><span id="eq-CARA_utility_expected_diff"><span class="math display">\[
u(\mathbb{E}X) = \mathrm{e}^{\rho\cdot 1} &gt; \frac{1}{2}\mathrm{e}^{\rho\cdot 0.5}+\frac{1}{2}\mathrm{e}^{\rho\cdot 1.5} = \mathbb{E}u(X),
\tag{7}\]</span></span></p>
<p>This example demonstrates that the utility of a certain outcome <span class="math inline">\((-\mathrm{e}^{\rho})\)</span> is preferred over the expected utility of a gamble. This preference underscores risk aversion. The situation is illustrated in the following plot:</p>
<p><em><a href="#fig-graphical-risk-prem" class="quarto-xref">Figure&nbsp;2</a>:</em></p>
<div id="cell-fig-graphical-risk-prem" class="cell" data-execution_count="7">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> utility</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>fig,ax <span class="op">=</span> utility.plot(RHO, x_gamble, p_gamble, u_func, x_func, plt)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div id="fig-graphical-risk-prem" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-graphical-risk-prem-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="2-expectation_utility_files/figure-html/fig-graphical-risk-prem-output-1.png" width="834" height="518" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-graphical-risk-prem-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;2: Graphical illustration of the risk premium
</figcaption>
</figure>
</div>
</div>
</div>
<p>The code is a bit too long to be included here but can be found in the local module <code>utility.py</code> in this repository.</p>
<p>As we can see, the utility at expected wealth 1 is about -0.37, while the mean utility is lower at -0.41. You can verify that the line drawn between the utility of 0.5 and 1.5 intersects the mean utility of -0.41.</p>
<p>Hence, with a concave utility function, a person will always prefer a sure amount rather than a bet with the same expected payoff. In this case, the risk-averse investor will invariably prefer the certain payment of 1 over the gamble.</p>
<p>The difference indicated by <span class="math inline">\(\rho\)</span> in the figure is the certainty equivalence. It is the amount that you would need to compensate the investor in order to take the gamble. In a real market, this is the premium that investors demand to hold risky assets compared to safe bills. It is usually about 2-4% on average for the whole market.</p>
</section>
<section id="a-continuous-example" class="level2">
<h2 class="anchored" data-anchor-id="a-continuous-example">A continuous example</h2>
<p>Let us now calculate the expected utility with more than two outcomes. We remember from the calculation of <a href="#fig-discrete-normal" class="quarto-xref">Figure&nbsp;1</a> and the calculation of discrete expectations in <a href="#eq-descrete_exp" class="quarto-xref">Equation&nbsp;2</a> that a discrete version of the continuous normal distribution can be calculated by taking the sum of probabilities and outcomes. When the outcomes are utilities, we sum over probabilities and utilities for each <span class="math inline">\(x\)</span>. If the utility is <span class="math inline">\(u(x) = - \mathrm{e}(-\rho x)\)</span> and <span class="math inline">\(x\)</span> and <span class="math inline">\(p\)</span> are calculated as above, a discrete approximation to the continuous expected utility, given <span class="math inline">\(x\)</span> is normally distributed, is</p>
<div id="876d99d0" class="cell" data-execution_count="8">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Approximate expected utility:</span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(p<span class="op">*</span>dx<span class="op">*</span>u_func(x, RHO))<span class="sc">}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Approximate expected utility:-268031.5499517654</code></pre>
</div>
</div>
<p>The above is a discrete approximation. How do we calculate the exact expected utility? We can find this by integration; see <a href="#eq-cont_exp" class="quarto-xref">Equation&nbsp;3</a>. The normal density function is given by</p>
<p><span id="eq-normal_density"><span class="math display">\[
\frac{1}{\sigma \sqrt{2 \pi}}e^{-\frac{(x-\mu)^2}{2 \sigma}}
\tag{8}\]</span></span></p>
<p>We can calculate the expected utility by taking the integral over the product of the density and the utility function. It turns out that if we do that, we obtain the analytical expected utility function:</p>
<p><span id="eq-exp_utility"><span class="math display">\[
\mathbb{E}[u(X)] = \int_{-\infty}^{\infty} u(x) f(x)\ dx = -e^{-\rho(\mu-\frac{1}{2}\rho \sigma^2)}
\tag{9}\]</span></span></p>
<p>Let us now try to compare this with our approximated expected utility above. If we have a standard normal distribution, so <span class="math inline">\(\sigma=1\)</span> and <span class="math inline">\(\mu=0\)</span>. The risk aversion coefficient is <span class="math inline">\(\rho=1\)</span>. The exact and approximate expected utility are</p>
<div id="c17930a8" class="cell" data-execution_count="9">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>RHO <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>dx <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>minmax <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="op">-</span>minmax, minmax <span class="op">+</span> dx, dx)</span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> norm.pdf(x, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Exact expected utility:</span><span class="sc">{</span><span class="op">-</span>np<span class="sc">.</span>exp(<span class="op">-</span>RHO<span class="op">*</span>(<span class="dv">0</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span>RHO<span class="op">*</span><span class="fl">1.0</span>))<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Approximate expected utility:</span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(p<span class="op">*</span>dx<span class="op">*</span>u_func(x, RHO))<span class="sc">}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Exact expected utility:-1.6487212707001282
Approximate expected utility:-1.625001554959029</code></pre>
</div>
</div>
<p>As we can clearly see from above, the approximation is not good. The problem is that the discrete normal probability function that we have used is too coarse. We therefore need to try smaller intervals for the bars. Also, we want to calculate a wider range than +/-4. Let us try with a bar width of 0.25 and a range of +/- 8: <em><a href="#fig-descrete-normal_fine" class="quarto-xref">Figure&nbsp;3</a>:</em></p>
<div id="cell-fig-descrete-normal_fine" class="cell" data-execution_count="10">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>RHO <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>dx <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>minmax <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>x <span class="op">=</span> np.arange(<span class="op">-</span>minmax, minmax <span class="op">+</span> dx, dx)</span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>p <span class="op">=</span> norm.pdf(x, <span class="dv">0</span>, <span class="dv">1</span>)</span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> utility.plot_descrete_and_normal(p, x, dx, minmax, plt)</span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a>expected_utility <span class="op">=</span> np.<span class="bu">sum</span>(p<span class="op">*</span>dx<span class="op">*</span>u_func(x, RHO))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Exact expected utility:</span><span class="sc">{</span><span class="op">-</span>np<span class="sc">.</span>exp(<span class="op">-</span>RHO<span class="op">*</span>(<span class="dv">0</span><span class="op">-</span><span class="fl">0.5</span><span class="op">*</span>RHO<span class="op">*</span><span class="fl">1.0</span>))<span class="sc">}</span><span class="ss">'</span>)</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f'Approximate expected utility:</span><span class="sc">{</span>np<span class="sc">.</span><span class="bu">sum</span>(p<span class="op">*</span>dx<span class="op">*</span>u_func(x, RHO))<span class="sc">}</span><span class="ss">'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-stdout">
<pre><code>Exact expected utility:-1.6487212707001282
Approximate expected utility:-1.648721270698128</code></pre>
</div>
<div class="cell-output cell-output-display">
<div id="fig-descrete-normal_fine" class="quarto-float quarto-figure quarto-figure-center anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-descrete-normal_fine-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="2-expectation_utility_files/figure-html/fig-descrete-normal_fine-output-2.png" width="611" height="449" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-descrete-normal_fine-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;3: Graphical illustration of the risk premium
</figcaption>
</figure>
</div>
</div>
</div>
<p>We see now in <a href="#fig-descrete-normal_fine" class="quarto-xref">Figure&nbsp;3</a> that the discrete distribution is quite similar to the continuous one, and the approximation is also very close to the analytically exact expected utility.</p>
</section>
<section id="the-objective-function" class="level2">
<h2 class="anchored" data-anchor-id="the-objective-function">The objective function</h2>
<p>The most important lesson here is what is inside the brackets in equation (<a href="#eq-exp_utility" class="quarto-xref">Equation&nbsp;9</a>). That expression effectively determines the utility, so let us rewrite it here:</p>
<p><span id="eq-mean-variance"><span class="math display">\[
\mu-\frac{1}{2}\rho \sigma^2
\tag{10}\]</span></span></p>
<p>This is therefore usually assumed to be the <em>objective function</em> of any investor.</p>
<p>Hence, if returns are normally distributed, then investors would want to maximize the difference between the mean and the variance. This is true for any utility function if returns are normally distributed, but it is not in general true if returns are distributed differently.</p>
<ul>
<li><strong>Challenge 4</strong>: Calculate the approximate expected utility with some other parameters and a non-standard normal distribution (<span class="math inline">\(\sigma\neq1\)</span> and <span class="math inline">\(\mu\neq1\)</span>), and see if the approximate is still a good approximation.</li>
</ul>
</section>
</section>
<section id="optimal-portfolio-with-one-asset" class="level1">
<h1>Optimal Portfolio with One Asset</h1>
<p>With the knowledge from <a href="#eq-mean-variance" class="quarto-xref">Equation&nbsp;10</a>, we can actually calculate the optimal level of investment for one risky asset and a risk-free allocation <span class="citation" data-cites="Tobin1958">(<a href="#ref-Tobin1958" role="doc-biblioref">Tobin 1958</a>)</span>. We will later see that the method for doing that is very similar to how we calculate optimal portfolios with many different assets. For now, we will assume we only consider one asset, for example the market index. Say you buy shares for <span class="math inline">\(w\)</span> NOK. Then, we can use the method in the previous section to find that the expected utility depends on</p>
<p><span id="eq-mean-variance2"><span class="math display">\[
w\mu-\frac{w^2}{2}\rho \sigma^2
\tag{11}\]</span></span></p>
<ul>
<li><strong>Challenge 5</strong>: Show that when multiplying a random variable by a constant, the variance is the variance of the random variable times the square of the constant.</li>
</ul>
<p>Taking the derivative of <a href="#eq-mean-variance2" class="quarto-xref">Equation&nbsp;11</a>, which we assume is a concave and increasing function, we get</p>
<p><span id="eq-mean-variance-diff"><span class="math display">\[
\frac{d(w\mu-\frac{w^2}{2}\rho \sigma^2)}{dw} = \mu-w\rho \sigma^2
\tag{12}\]</span></span></p>
<p>Setting <a href="#eq-mean-variance-diff" class="quarto-xref">Equation&nbsp;12</a> equal to zero and solving for <span class="math inline">\(w\)</span> gives</p>
<p><span id="eq-mean-variance-diff0"><span class="math display">\[
w=\frac{\mu}{\rho \sigma^2}
\tag{13}\]</span></span></p>
<p>From this, we conclude:</p>
<ol type="1">
<li>Higher risk aversion leads to less investment.</li>
<li>Greater expected returns encourage more investment.</li>
<li>Increased risk (<span class="math inline">\(\sigma^2\)</span>) discourages investment.</li>
</ol>
<p>In the next lecture, we will extend these principles to portfolios with multiple assets using matrix algebra.</p>
<section id="investor-types" class="level2">
<h2 class="anchored" data-anchor-id="investor-types">Investor Types</h2>
<p>The shape of a utility function critically influences how individuals respond to risk. This subsection discusses three primary types of investors based on their risk preferences and the corresponding shapes of their utility functions. <span class="math inline">\(\rho&gt;0\)</span>.</p>
<ul>
<li><p><strong>Risk-Averse Investors:</strong> These individuals have concave utility functions, as in the example above, indicating a preference for certain outcomes over uncertain ones with the same expected value. Commonly modelled in financial theory, risk-averse investors prioritise minimising risk over maximising returns. They tend to diversify their portfolios across various asset classes to reduce volatility. Even with the option of unlimited borrowing, they typically opt to limit their investment exposure. <span class="math inline">\(\rho&gt;0\)</span>.</p></li>
<li><p><strong>Risk-Neutral Investors:</strong> For risk-neutral individuals, volatility is inconsequential. Their utility functions are linear, reflecting indifference to the level of risk associated with any investment. They focus solely on maximising expected returns and are likely to invest in the asset with the highest expected payoff, irrespective of the associated risks. This type of investor is willing to allocate as much capital as possible to maximise potential gains. <span class="math inline">\(\rho&lt;0\)</span></p></li>
<li><p><strong>Risk-Loving (Risk-Seeking) Investors:</strong> Risk lovers have convex utility functions and engage in behaviours akin to gambling, where the expected return is typically negative. They derive satisfaction from the risk itself and often pursue investments that offer the highest possible returns, irrespective of the high levels of risk involved. Such behaviour is commonly seen in speculative ventures and high-stakes gambling. <span class="math inline">\(\rho=0\)</span></p></li>
</ul>
<p>Interestingly, it is not uncommon for individuals to display traits of both risk-averse and risk-seeking behaviours, a phenomenon that may seem paradoxical. For instance, the same person might purchase insurance (a risk-averse action) while also indulging in lottery gambling (a risk-seeking behaviour). This can be explained by the utility function’s varying shape at different levels of wealth or stakes: a person might be risk-seeking with small, disposable amounts of money but risk-averse with larger, life-impacting sums. This dual nature influences how individuals choose to allocate their investments across different risk levels.</p>
</section>
<section id="assumptions-in-a-financial-market" class="level2">
<h2 class="anchored" data-anchor-id="assumptions-in-a-financial-market">Assumptions in a Financial Market</h2>
<p>In financial theory, the assumption typically made about market participants is that they are predominantly risk-averse. This assumption is crucial, as portfolio optimisation and related strategies largely rely on this characteristic. Risk-neutral or risk-loving investors, who either disregard risk or actively seek it, are considered exceptions rather than the norm in these models. This foundational assumption allows for the development of investment strategies that aim to maximise returns while minimising risk, aligning with the preferences of risk-averse individuals.</p>
</section>
</section>
<section id="the-risk-premium" class="level1">
<h1>The Risk Premium</h1>
<p>We understand that a risk-averse individual has a concave utility function, indicated by <span class="math inline">\(u^{\prime \prime}(x) &lt; 0\)</span>. But how do we quantify the degree of risk aversion?</p>
<p>A direct approach might be to use the second derivative of the utility function, <span class="math inline">\(u^{\prime \prime}(x)\)</span>, as a measure of risk aversion. However, this method has limitations, particularly at higher wealth levels. The issue arises because the curvature of the utility function tends to flatten as wealth increases, implying a decrease in relative risk aversion. If we solely relied on <span class="math inline">\(u^{\prime \prime}(x)\)</span> for measuring risk aversion, it might inaccurately suggest that wealthier individuals become nearly risk-neutral, due to the diminishing curvature in their utility functions. In other words, we might prefere a measure of risk aversion that</p>
<p>This phenomenon can be explained by the principle of decreasing marginal utility, which asserts that the incremental value or utility derived from each additional unit of wealth diminishes at higher wealth levels.</p>
<section id="absolute-risk-aversion-ara" class="level2">
<h2 class="anchored" data-anchor-id="absolute-risk-aversion-ara">Absolute Risk Aversion (ARA)</h2>
<p>A more nuanced measure of risk aversion is defined through the Absolute Risk Aversion (ARA) <span class="citation" data-cites="Pratt1964 Arrow1971">(<a href="#ref-Pratt1964" role="doc-biblioref">Pratt 1964</a>; <a href="#ref-Arrow1971" role="doc-biblioref">Arrow 1971</a>)</span> index, given by:</p>
<p><span id="eq-ARA_def"><span class="math display">\[
\rho_{ARA}(x) = -\frac{u''(x)}{u'(x)}
\tag{14}\]</span></span></p>
<p>This metric, also known as the Arrow–Pratt measure of risk aversion, remains robust against the non-linear scaling of wealth. As wealth increases, both the second derivative <span class="math inline">\(u''(x)\)</span> and the first derivative <span class="math inline">\(u'(x)\)</span> typically decrease, but their ratio, representing the ARA, adjusts proportionally. Thus, the measure of risk aversion does not necessarily approach zero as wealth grows, providing a more reliable indicator across different wealth levels.</p>
<p>This measure is intrinsically linked to the concept of the risk premium.</p>
<section id="constant-absolute-risk-aversion-cara" class="level3">
<h3 class="anchored" data-anchor-id="constant-absolute-risk-aversion-cara">Constant Absolute Risk Aversion (CARA)</h3>
<p>If ARA is constant, we refer to it as Constant Absolute Risk Aversion (CARA). The utility function aligning with CARA can be derived by solving the differential equation $ _{CARA} = -u’‘/u’ $, which gives:</p>
<p><span id="eq-CARA_def"><span class="math display">\[
u(x) = -e^{-x \cdot \rho_{CARA}}
\tag{15}\]</span></span></p>
<p>This is the exact same utility function as in the previous examples. Although the CARA utility function is negative, it should not be interpreted as the individual deriving negative utility from wealth. Instead, it serves as a ranking mechanism among different wealth levels, ensuring <span class="math inline">\(u(x) &gt; u(y)\)</span> whenever <span class="math inline">\(x &gt; y\)</span>, and <span class="math inline">\(u(x) &gt; u(y)\)</span> whenever <span class="math inline">\(\mathrm{var}(x) &gt; \mathrm{var}(y)\)</span> and <span class="math inline">\(x=y\)</span>.</p>
<p>This utility specification simplifies calculations and is extensively used due to its mathematical tractability. It also implies that for a CARA utility function, the risk premium can be calculated exactly as <span class="math inline">\(\frac{1}{2} \pi_{ARA} \sigma^2\)</span>.</p>
</section>
</section>
<section id="relative-risk-aversion-rra" class="level2">
<h2 class="anchored" data-anchor-id="relative-risk-aversion-rra">Relative Risk Aversion (RRA)</h2>
<p>Relative Risk Aversion (RRA) is more applicable when the risky decision involves a proportion of an individual’s wealth rather than a fixed amount. This measure is particularly relevant when returns are expressed as a percentage of wealth, aligning more closely with practical financial scenarios. RRA is mathematically defined as:</p>
<p><span id="eq-RRA_def"><span class="math display">\[
\pi_{RRA}(x) = -x \frac{u''(x)}{u'(x)}
\tag{16}\]</span></span></p>
<p>The choice between using Absolute Risk Aversion (ARA) and RRA depends on the nature of the risk involved. RRA is preferred when analysing bets that are proportional to wealth, while ARA is more suitable for fixed-level bets.</p>
<p>The constant RRA utility is a Cobb–Douglas-type function:</p>
<p><span id="eq-CRRA_def"><span class="math display">\[
u_{CRRA}(x) = x^{1-\pi_{CRRA}}
\tag{17}\]</span></span></p>
<p>Except for when <span class="math inline">\(\pi_{CRRA}=1\)</span>, where</p>
<p><span id="eq-CRRA_def"><span class="math display">\[
u_{CRRA}(x)|_{pi_{CRRA}=1} = \log(x)
\tag{18}\]</span></span></p>
</section>
</section>
<section id="the-normal-distribution-and-risk" class="level1">
<h1>The Normal Distribution and risk</h1>
<p>As mentioned, if the distribution of returns is normal, the investor should always maximise the difference between mean and variance. However, if the returns are distributed differently, that is not the case.</p>
<p>It is well known that returns in financial markets are not normally distributed. For example, under the assumption that returns on the Oslo Stock Exchange follow a normal distribution, statistically extreme changes exceeding 10% would be exceedingly rare—estimated to occur once every 17,000 years. Yet, during the 2008 financial crisis, such anomalies were observed twice.</p>
<p>This is called “fat tails”. It means that extreme events are much more likely in actual financial markets than in the normal-distribution world.</p>
<p>However, in most cases, we can represent the empirical distribution with a “mixed normal distribution”. A mixed normal distribution is a linear combination of normal distributions with different means and variances.</p>
<div id="789a9a60" class="cell" data-execution_count="11">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Set range</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>MAX_MIN <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>x_vals <span class="op">=</span> np.linspace(<span class="op">-</span>MAX_MIN, MAX_MIN, <span class="dv">1000</span>)</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot using fig and ax</span></span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate mean and std:</span></span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>rmean <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>rstd <span class="op">=</span> <span class="fl">0.01</span></span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Normal distribution and mixed normal distribution:</span></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>norm_dist    <span class="op">=</span>     norm.pdf(x_vals, loc<span class="op">=</span>rmean, scale<span class="op">=</span>rstd)</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>fat_tails <span class="op">=</span> (<span class="fl">0.8</span> <span class="op">*</span> norm.pdf(x_vals, loc<span class="op">=</span>rmean, scale<span class="op">=</span>rstd<span class="op">*</span><span class="fl">0.5</span>) </span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>           <span class="op">+</span> <span class="fl">0.2</span> <span class="op">*</span> norm.pdf(x_vals, loc<span class="op">=</span>rmean, scale<span class="op">=</span>rstd<span class="op">*</span><span class="dv">2</span>))</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting</span></span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>ax.plot(x_vals, norm_dist, label<span class="op">=</span><span class="st">"Normal Distribution"</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>ax.plot(x_vals, fat_tails, label<span class="op">=</span><span class="st">"Mixed Normal (Fat Tails)"</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Set title, labels, and grid and legend</span></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Mixed Normal Distribution Illustrating Fat Tails'</span>)</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'X'</span>)</span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Probability Density'</span>)</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a>ax.legend()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2-expectation_utility_files/figure-html/cell-12-output-1.png" width="659" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<section id="empirical-distribution" class="level2">
<h2 class="anchored" data-anchor-id="empirical-distribution">Empirical distribution</h2>
<p>Let us examine how empirical returns compare with the normal distribution, and also attempt to fit a mixed normal distribution to the data. We will use data from <a href="https://titlon.uit.no">https://titlon.uit.no</a> to create a histogram and overlay a fitted normal density to assess whether the empirical distribution exhibits heavy (fat) tails. We will then compare this with a simple mixed normal (Gaussian mixture) fit.</p>
<p>We start by fetching data for the OSEBX index from <a href="https://titlon.uit.no">titlon.uit.no</a>.</p>
<div id="92696bd1" class="cell" data-execution_count="12">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="co">#Query script for MySQL client</span></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pymysql</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>con <span class="op">=</span> pymysql.<span class="ex">connect</span>(host<span class="op">=</span><span class="st">'titlon.uit.no'</span>, </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a>                user      <span class="op">=</span> <span class="st">"user@uit.no"</span>,</span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a>                password  <span class="op">=</span> <span class="st">"pawswordfromtitlon"</span>,</span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a>                    database<span class="op">=</span><span class="st">'OSE'</span>)  </span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>crsr<span class="op">=</span>con.cursor()</span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>crsr.execute(<span class="st">"""</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a><span class="st">    SELECT </span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a><span class="st">    `Date`, `OSEBXLinked`, `OBXLinked`, `OSEFXLinked`, `ID` </span></span>
<span id="cb20-12"><a href="#cb20-12" aria-hidden="true" tabindex="-1"></a><span class="st">    FROM `OSE`.`equityindex_linked` </span></span>
<span id="cb20-13"><a href="#cb20-13" aria-hidden="true" tabindex="-1"></a><span class="st">    WHERE year(`Date`) &gt;= 1980</span></span>
<span id="cb20-14"><a href="#cb20-14" aria-hidden="true" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb20-15"><a href="#cb20-15" aria-hidden="true" tabindex="-1"></a><span class="st">"""</span>)</span>
<span id="cb20-16"><a href="#cb20-16" aria-hidden="true" tabindex="-1"></a>r<span class="op">=</span>crsr.fetchall()</span>
<span id="cb20-17"><a href="#cb20-17" aria-hidden="true" tabindex="-1"></a>df<span class="op">=</span>pd.DataFrame(<span class="bu">list</span>(r), </span>
<span id="cb20-18"><a href="#cb20-18" aria-hidden="true" tabindex="-1"></a>        columns<span class="op">=</span>[i[<span class="dv">0</span>] <span class="cf">for</span> i <span class="kw">in</span> crsr.description])</span>
<span id="cb20-19"><a href="#cb20-19" aria-hidden="true" tabindex="-1"></a>df</span>
<span id="cb20-20"><a href="#cb20-20" aria-hidden="true" tabindex="-1"></a><span class="co">#YOU NEED TO BE CONNECTED TO YOUR INSTITUTION VIA VPN, </span></span>
<span id="cb20-21"><a href="#cb20-21" aria-hidden="true" tabindex="-1"></a><span class="co">#OR BE AT THE INSTITUTION, FOR THIS CODE TO WORK</span></span>
<span id="cb20-22"><a href="#cb20-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-23"><a href="#cb20-23" aria-hidden="true" tabindex="-1"></a>pd.to_pickle(df,<span class="st">'data/index.df'</span>)</span>
<span id="cb20-24"><a href="#cb20-24" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> <span class="va">None</span> <span class="co">#in order to avoid memory problems</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
<p>We then calculate the return series and create a histogram of daily returns. The sample mean and standard deviation for the period are also computed to provide a simple summary of the distribution.</p>
<div id="a14c1a13" class="cell" data-execution_count="13">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib <span class="im">import</span> pyplot <span class="im">as</span> plt</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="co"># loading the data</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pd.read_pickle(<span class="st">'data/index.df'</span>)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Creating the plot using fig and ax</span></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="co">#fixing Date, setting index and calculate returns</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Date'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'Date'</span>])</span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>df.set_index(<span class="st">'Date'</span>, inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Returns'</span>] <span class="op">=</span> df[<span class="st">'OSEBXLinked'</span>].pct_change()</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a><span class="co">#Calculate mean and std:</span></span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a>rmean <span class="op">=</span> np.mean(df[<span class="st">'Returns'</span>])</span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a>rstd <span class="op">=</span> np.std(df[<span class="st">'Returns'</span>])</span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a><span class="co"># Define the histogram intervals (dx = 0.01)</span></span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>dx <span class="op">=</span> <span class="fl">0.002</span></span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a>bins <span class="op">=</span> <span class="bu">int</span>((<span class="fl">0.2</span> <span class="op">-</span> (<span class="op">-</span><span class="fl">0.2</span>)) <span class="op">/</span> dx)</span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the plot</span></span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>ax.hist(df[<span class="st">'Returns'</span>].dropna(), bins<span class="op">=</span>bins, </span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>        <span class="bu">range</span><span class="op">=</span>(<span class="op">-</span><span class="fl">0.2</span>, <span class="fl">0.2</span>), density<span class="op">=</span><span class="va">True</span>, </span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a>        edgecolor<span class="op">=</span><span class="st">'k'</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> <span class="va">None</span></span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a><span class="co"># Set x-axis limits</span></span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a>ax.set_xlim(<span class="op">-</span>MAX_MIN, MAX_MIN)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="2-expectation_utility_files/figure-html/cell-14-output-1.png" width="660" height="411" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<p>Next, we compute the fitted normal and a simple mixed normal using the estimated mean and standard deviation. For the mixture, we choose (by trial and error) an 80% weight on a normal with 40% of the estimated volatility and a 20% weight on a normal with 200% of the estimated volatility.</p>
<p>Both fitted densities are then overlaid on the existing histogram for comparison.</p>
<div id="9dda31cd" class="cell" data-execution_count="14">
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb22"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> norm</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a><span class="co">#Defining the range of x-values:</span></span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a>MAX_MIN <span class="op">=</span> <span class="fl">0.1</span></span>
<span id="cb22-7"><a href="#cb22-7" aria-hidden="true" tabindex="-1"></a>x_vals <span class="op">=</span> np.linspace(<span class="op">-</span>MAX_MIN, MAX_MIN, <span class="dv">1000</span>)</span>
<span id="cb22-8"><a href="#cb22-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-9"><a href="#cb22-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate normal dist and the mixed normal dist:</span></span>
<span id="cb22-10"><a href="#cb22-10" aria-hidden="true" tabindex="-1"></a>norm_dist    <span class="op">=</span>     norm.pdf(x_vals, loc<span class="op">=</span>rmean, scale<span class="op">=</span>rstd)</span>
<span id="cb22-11"><a href="#cb22-11" aria-hidden="true" tabindex="-1"></a>fat_tails <span class="op">=</span> (<span class="fl">0.8</span> <span class="op">*</span> norm.pdf(x_vals, loc<span class="op">=</span>rmean, scale<span class="op">=</span>rstd<span class="op">*</span><span class="fl">0.4</span>) <span class="op">+</span> </span>
<span id="cb22-12"><a href="#cb22-12" aria-hidden="true" tabindex="-1"></a>             <span class="fl">0.2</span> <span class="op">*</span> norm.pdf(x_vals, loc<span class="op">=</span>rmean, scale<span class="op">=</span>rstd<span class="op">*</span><span class="dv">2</span>))</span>
<span id="cb22-13"><a href="#cb22-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-14"><a href="#cb22-14" aria-hidden="true" tabindex="-1"></a><span class="co"># Plotting normal dist and mixed normal dist</span></span>
<span id="cb22-15"><a href="#cb22-15" aria-hidden="true" tabindex="-1"></a>ax.plot(x_vals, norm_dist, </span>
<span id="cb22-16"><a href="#cb22-16" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="st">"Normal Distribution"</span>, color<span class="op">=</span><span class="st">'blue'</span>)</span>
<span id="cb22-17"><a href="#cb22-17" aria-hidden="true" tabindex="-1"></a>ax.plot(x_vals, fat_tails, </span>
<span id="cb22-18"><a href="#cb22-18" aria-hidden="true" tabindex="-1"></a>            label<span class="op">=</span><span class="st">"Mixed Normal (Fat Tails)"</span>, color<span class="op">=</span><span class="st">'red'</span>)</span>
<span id="cb22-19"><a href="#cb22-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-20"><a href="#cb22-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Set title, labels and legend</span></span>
<span id="cb22-21"><a href="#cb22-21" aria-hidden="true" tabindex="-1"></a>ax.set_title(<span class="st">'Mixed Normal Distribution'</span> </span>
<span id="cb22-22"><a href="#cb22-22" aria-hidden="true" tabindex="-1"></a>                <span class="st">'Illustrating Fat Tails'</span>)</span>
<span id="cb22-23"><a href="#cb22-23" aria-hidden="true" tabindex="-1"></a>ax.set_xlabel(<span class="st">'X'</span>)</span>
<span id="cb22-24"><a href="#cb22-24" aria-hidden="true" tabindex="-1"></a>ax.set_ylabel(<span class="st">'Probability Density'</span>)</span>
<span id="cb22-25"><a href="#cb22-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-26"><a href="#cb22-26" aria-hidden="true" tabindex="-1"></a>fig</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<div class="cell-output cell-output-display" data-execution_count="26">
<div>
<figure class="figure">
<p><img src="2-expectation_utility_files/figure-html/cell-15-output-1.png" width="678" height="449" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="literature" class="level1">
<h1>Literature</h1>
<div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-Arrow1971" class="csl-entry" role="listitem">
Arrow, Kenneth J. 1971. <em>Essays in the Theory of Risk-Bearing</em>. Chicago: Markham Publishing Company.
</div>
<div id="ref-Euler1748" class="csl-entry" role="listitem">
Euler, Leonhard. 1748. <em>Introductio in Analysin Infinitorum</em>. Lausanne: Marc Michel Bousquet.
</div>
<div id="ref-Gauss1809" class="csl-entry" role="listitem">
Gauss, Carl Friedrich. 1809. <em>Theoria Motus Corporum Coelestium in Sectionibus Conicis Solem Ambientium</em>. Hamburg: Perthes; Besser.
</div>
<div id="ref-Leibniz1969" class="csl-entry" role="listitem">
Leibniz, Gottfried Wilhelm. 1969. <em>Leibniz: The Early Mathematical Manuscripts</em>. Edited by Joseph E. Hofmann. New York: Dover Publications.
</div>
<div id="ref-vonNeumann1947" class="csl-entry" role="listitem">
Neumann, John von, and Oskar Morgenstern. 1947. <em>Theory of Games and Economic Behavior</em>. 2nd ed. Princeton, NJ: Princeton University Press.
</div>
<div id="ref-Pratt1964" class="csl-entry" role="listitem">
Pratt, John W. 1964. <span>“Risk Aversion in the Small and in the Large.”</span> <em>Econometrica</em> 32 (1/2): 122–36. <a href="https://doi.org/10.2307/1913738">https://doi.org/10.2307/1913738</a>.
</div>
<div id="ref-Tobin1958" class="csl-entry" role="listitem">
Tobin, James. 1958. <span>“Liquidity Preference as Behavior Towards Risk.”</span> <em>The Review of Economic Studies</em> 25 (2): 65–86. <a href="https://doi.org/10.2307/2296205">https://doi.org/10.2307/2296205</a>.
</div>
</div>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>